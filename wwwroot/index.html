<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WM 2026 Tippspiel</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/app.css?v=11">
</head>
<body>

<!-- ═══ LOGIN OVERLAY ═══════════════════════════════════════════════════ -->
<div id="login-overlay">
  <div class="login-card">
    <div class="login-card-header">
      <div class="login-logo">&#127942;</div>
      <div class="login-badge">WM 2026 &bull; Tippspiel</div>
      <div class="login-title">Willkommen!</div>
    </div>
    <div class="login-card-body">
      <div class="login-sub">Bitte Namen, Tipper-ID oder <strong>Admin</strong> eingeben, um fortzufahren.</div>
      <form onsubmit="doLogin(event)">
        <input type="text" id="login-input" class="login-input" placeholder="Name / ID / Admin" autocomplete="off" autofocus>
        <select id="login-dataset-select" class="login-dataset-select">
          <option value="vor_turnier">&#128197; Vor dem Turnier</option>
          <option value="nach_gruppe">&#9917; Nach der Gruppenphase</option>
          <option value="nach_turnier">&#127942; Nach dem Turnier</option>
        </select>
        <button type="submit" class="login-btn">Weiter &rarr;</button>
      </form>
      <div id="login-error" class="login-error" style="display:none;"></div>
    </div>
  </div>
</div>

<header style="display:none;" id="main-header">
  <span class="logo">&#127942; WM 2026</span>
  <div style="flex:1;">
    <div class="header-label">Tippspiel &amp; Bingo</div>
    <div class="sub" id="header-sub">Verwaltung der Tipper &amp; Auswertung</div>
  </div>
  <button class="btn btn-ghost btn-sm" onclick="doLogout()" style="margin-left:auto;color:#fff;border-color:rgba(255,255,255,.3);">&#8617; Abmelden</button>
</header>

<!-- Main navigation (dynamically populated) -->
<nav class="main-nav" id="main-nav" style="display:none;"></nav>

<div class="container">

  <!-- ═══ PAGE: TIPPER (Admin only) ════════════════════════════════════ -->
  <div id="page-users" class="main-page" style="display:none;">

    <!-- List view -->
    <div id="view-list">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <h2>Tipper</h2>
        <button class="btn btn-primary" onclick="newUser()">+ Neuer Tipper</button>
      </div>
      <div class="card" id="users-table-wrap">
        <div class="empty-state">Lade Tipper ...</div>
      </div>
    </div>

    <!-- Form view -->
    <div id="view-form" style="display:none;">
      <div class="back-btn-wrap">
        <button class="btn btn-ghost" onclick="showList()">&larr; Zur&uuml;ck</button>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <h2 id="form-title">Neuer Tipper</h2>
        <button class="btn btn-success" onclick="saveUser()">&#10003; Speichern</button>
      </div>

      <div class="card">
        <div class="row">
          <div class="field">
            <label>Name *</label>
            <input type="text" id="f-name" placeholder="Vor- und Nachname" required>
          </div>
          <div class="field">
            <label>Tipper-ID (auto wenn leer)</label>
            <input type="text" id="f-id" placeholder="z.B. USR-042">
          </div>
        </div>
      </div>

      <div class="tab-bar">
        <button class="tab-btn active" onclick="switchTab(this,'t-groups')">&#9917; Gruppenspiele (72)</button>
        <button class="tab-btn" onclick="switchTab(this,'t-ko')">&#127942; K.O.-Runden</button>
        <button class="tab-btn" onclick="switchTab(this,'t-special')">&#11088; Sondertipps</button>
        <button class="tab-btn" onclick="switchTab(this,'t-bingo')">&#127920; Bingo-Karte</button>
      </div>

      <div id="t-groups" class="tab-panel active">
        <div id="group-matches-container"><div class="empty-state">Lade Spiele ...</div></div>
      </div>

      <div id="t-ko" class="tab-panel">
        <div id="ko-rounds-container"><div class="empty-state">Lade KO-Runden ...</div></div>
      </div>

      <div id="t-special" class="tab-panel">
        <div class="card">
          <div class="section-title">Sondertipps (je 20 Punkte)</div>
          <div class="row">
            <div class="field">
              <label>Weltmeister (Team)</label>
              <select id="f-worldchamp"><option value="">-- Team ausw&auml;hlen --</option></select>
            </div>
            <div class="field">
              <label>Torsch&uuml;tzenkönig (vollst. Name)</label>
              <input type="text" id="f-topscorer" placeholder="z.B. Jamal Musiala">
            </div>
          </div>
        </div>
      </div>

      <div id="t-bingo" class="tab-panel">
        <div class="card">
          <div class="section-title">Bingo-Karte (5&#xD7;5)</div>
          <p style="font-size:.85rem;color:var(--muted);margin-bottom:1rem;">
            W&auml;hle f&uuml;r jedes Feld ein Ereignis aus dem Katalog.
            Jedes Ereignis kann nur einmal gew&auml;hlt werden.
            Das mittlere Feld (Position 12) ist das <strong>FREE-Feld</strong>.
          </p>
          <div class="bingo-grid" id="bingo-grid-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══ PAGE: MEINE TIPPS (User mode) ═══════════════════════════════ -->
  <div id="page-my-tips" class="main-page" style="display:none;">

    <!-- Lock banner (shown when betting is locked) -->
    <div id="my-lock-banner" class="lock-banner" style="display:none;">
      &#128274; <strong>Tipps gesperrt</strong> &ndash;
      F&uuml;r den gew&auml;hlten Datensatz sind die Tipps gesperrt.
      Deine abgegebenen Tipps werden unten ausgewertet.
    </div>

    <!-- Save bar (shown when editable) -->
    <div id="my-save-bar" class="my-save-bar" style="display:none;">
      <span style="color:var(--muted);font-size:.85rem;">&#9997; Du kannst deine Tipps noch &auml;ndern.</span>
      <button class="btn btn-success" onclick="saveMyTips()">&#10003; Tipps speichern</button>
    </div>

    <div class="tab-bar" id="my-tab-bar">
      <button class="tab-btn active" onclick="switchTab(this,'mt-groups')">&#9917; Gruppenspiele</button>
      <button class="tab-btn" onclick="switchTab(this,'mt-ko')">&#127942; K.O.-Runden</button>
      <button class="tab-btn" onclick="switchTab(this,'mt-special')">&#11088; Sondertipps</button>
      <button class="tab-btn" onclick="switchTab(this,'mt-bingo')">&#127920; Bingo-Karte</button>
    </div>

    <div id="mt-groups" class="tab-panel active">
      <div id="my-group-matches-container"><div class="empty-state">Lade Spiele ...</div></div>
    </div>

    <div id="mt-ko" class="tab-panel">
      <div id="my-ko-rounds-container"><div class="empty-state">Lade KO-Runden ...</div></div>
    </div>

    <div id="mt-special" class="tab-panel">
      <div id="my-special-container"><div class="empty-state">Lade Sondertipps ...</div></div>
    </div>

    <div id="mt-bingo" class="tab-panel">
      <div id="my-bingo-container"><div class="empty-state">Lade Bingo-Karte ...</div></div>
    </div>
  </div>

  <!-- ═══ PAGE: AUSWERTUNG ════════════════════════════════════════════════ -->
  <div id="page-ranking" class="main-page" style="display:none;">

    <div class="calc-bar" id="admin-calc-bar">
      <span class="last-calc" id="last-calc-time"></span>
      <div style="display:flex;align-items:center;gap:.6rem;flex-wrap:wrap;">
        <button class="btn btn-primary" onclick="recalculate()">&#9654; Neu berechnen</button>
      </div>
    </div>
    <div id="user-calc-bar" style="display:none;">
      <span class="last-calc" id="user-last-calc-time"></span>
    </div>

    <!-- Stats summary -->
    <div class="stat-grid" id="stat-grid"></div>

    <!-- Sub-tabs -->
    <div class="tab-bar">
      <button class="tab-btn active" onclick="switchTab(this,'rt-board')">&#127942; Rangliste</button>
      <button class="tab-btn" onclick="switchTab(this,'rt-cluster')">&#128200; Gruppen-Cluster</button>
      <button class="tab-btn" onclick="switchTab(this,'rt-bingo')">&#127920; Bingo-Gewinne</button>
      <button class="tab-btn" onclick="switchTab(this,'rt-finance')">&#128181; Finanzen</button>
    </div>

    <div id="rt-board" class="tab-panel active">
      <div class="card" id="leaderboard-wrap"><div class="empty-state">Bitte Auswertung starten.</div></div>
    </div>

    <div id="rt-cluster" class="tab-panel">
      <div class="card" id="cluster-wrap"><div class="empty-state">Bitte Auswertung starten.</div></div>
    </div>

    <div id="rt-bingo" class="tab-panel">
      <div class="card" id="bingo-pots-wrap"><div class="empty-state">Bitte Auswertung starten.</div></div>
    </div>

    <div id="rt-finance" class="tab-panel">
      <div class="card" id="finance-wrap"><div class="empty-state">Bitte Auswertung starten.</div></div>
    </div>
  </div>

</div>

<div id="spinner"><div class="spin"></div></div>
<div id="toast"></div>

<script src="/js/app.js?v=7"></script>
</body>
</html>
